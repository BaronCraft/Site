<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Догони Деда Мороза - Новогодняя игра</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Roboto:wght@400;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #0a2e38, #0c3b4d);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            font-family: 'Mountains of Christmas', cursive;
            font-size: 3.5rem;
            color: #ff2a2a;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a8e6cf;
            margin-bottom: 20px;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid #a8e6cf;
            box-shadow: 0 0 15px rgba(168, 230, 207, 0.3);
        }

        .info-box {
            text-align: center;
        }

        .info-label {
            font-size: 0.9rem;
            color: #a8e6cf;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd166;
        }

        .game-area {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 500px;
            background: linear-gradient(to bottom, #1a5276, #0e3b5c);
            border-radius: 15px;
            overflow: hidden;
            border: 3px solid #a8e6cf;
            box-shadow: 0 0 20px rgba(168, 230, 207, 0.4);
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            background: linear-gradient(to bottom, #ff2a2a, #cc0000);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-family: 'Mountains of Christmas', cursive;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            background: linear-gradient(to bottom, #ff4d4d, #e60000);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn:disabled {
            background: linear-gradient(to bottom, #666, #444);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .instructions {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #a8e6cf;
            margin-top: 20px;
        }

        .instructions h2 {
            font-family: 'Mountains of Christmas', cursive;
            font-size: 2rem;
            color: #ffd166;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions p {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .key {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 10px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .snowflake {
            position: absolute;
            color: white;
            font-size: 1.5rem;
            user-select: none;
            z-index: -1;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #ffd166;
            box-shadow: 0 0 30px rgba(255, 209, 102, 0.5);
            z-index: 10;
            display: none;
            max-width: 80%;
        }

        .game-message h2 {
            font-family: 'Mountains of Christmas', cursive;
            font-size: 3rem;
            color: #ff2a2a;
            margin-bottom: 20px;
        }

        .game-message p {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: #a8e6cf;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #a8e6cf;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            .game-area {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Догони Деда Мороза!</h1>
            <p class="subtitle">Помоги снеговику догнать упряжку с оленями и забрать мешок с подарками!</p>
        </header>
        
        <div class="game-container">
            <div class="game-info">
                <div class="info-box">
                    <div class="info-label">ОЧКИ</div>
                    <div class="info-value" id="score">0</div>
                </div>
                <div class="info-box">
                    <div class="info-label">ВРЕМЯ</div>
                    <div class="info-value" id="time">60</div>
                </div>
                <div class="info-box">
                    <div class="info-label">РАССТОЯНИЕ</div>
                    <div class="info-value" id="distance">100</div>
                </div>
                <div class="info-box">
                    <div class="info-label">ПОДАРКИ</div>
                    <div class="info-value" id="gifts">0</div>
                </div>
            </div>
            
            <div class="game-area">
                <canvas id="gameCanvas"></canvas>
                <div class="game-message" id="gameMessage">
                    <h2 id="messageTitle">ПОБЕДА!</h2>
                    <p id="messageText">Вы догнали Деда Мороза и забрали все подарки!</p>
                    <button class="btn" id="restartButton">Играть снова</button>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" id="startButton">Начать игру</button>
                <button class="btn" id="pauseButton" disabled>Пауза</button>
                <button class="btn" id="restartBtn">Заново</button>
            </div>
            
            <div class="instructions">
                <h2>Как играть?</h2>
                <p>Цель игры - догнать Деда Мороза на его упряжке с оленями и забрать мешок с подарками.</p>
                <div class="instruction-item">
                    <span>Используйте клавиши <span class="key">←</span> и <span class="key">→</span> для движения влево и вправо</span>
                </div>
                <div class="instruction-item">
                    <span>Используйте клавишу <span class="key">ПРОБЕЛ</span> для прыжка</span>
                </div>
                <div class="instruction-item">
                    <span>Избегайте препятствий (снежные сугробы и ёлки)</span>
                </div>
                <div class="instruction-item">
                    <span>Соберите снежинки для дополнительных очков</span>
                </div>
                <p>У вас есть 60 секунд, чтобы догнать Деда Мороза. Удачи!</p>
            </div>
        </div>
        
        <footer>
            <p>С Новым Годом! © 2023 Догони Деда Мороза. Все права защищены.</p>
        </footer>
    </div>

    <script>
        // Создаем снежинки для фона
        function createSnowflakes() {
            const snowflakesContainer = document.createElement('div');
            snowflakesContainer.classList.add('snowflakes');
            document.body.appendChild(snowflakesContainer);
            
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.innerHTML = '❄';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.opacity = Math.random() * 0.5 + 0.5;
                snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
                snowflakesContainer.appendChild(snowflake);
            }
        }
        
        // Инициализация игры
        document.addEventListener('DOMContentLoaded', function() {
            createSnowflakes();
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const startButton = document.getElementById('startButton');
            const pauseButton = document.getElementById('pauseButton');
            const restartBtn = document.getElementById('restartBtn');
            const restartButton = document.getElementById('restartButton');
            const scoreElement = document.getElementById('score');
            const timeElement = document.getElementById('time');
            const distanceElement = document.getElementById('distance');
            const giftsElement = document.getElementById('gifts');
            const gameMessage = document.getElementById('gameMessage');
            const messageTitle = document.getElementById('messageTitle');
            const messageText = document.getElementById('messageText');
            
            // Устанавливаем размеры canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Игровые переменные
            let gameRunning = false;
            let gamePaused = false;
            let score = 0;
            let timeLeft = 60;
            let distance = 100;
            let gifts = 0;
            let gameInterval;
            let timeInterval;
            
            // Объекты игры
            const player = {
                x: 100,
                y: canvas.height - 150,
                width: 60,
                height: 80,
                speed: 8,
                jumpPower: 20,
                isJumping: false,
                jumpHeight: 0,
                maxJump: 150,
                gravity: 1.2,
                velocityY: 0
            };
            
            const santa = {
                x: canvas.width - 250,
                y: canvas.height - 200,
                width: 180,
                height: 120,
                speed: 3
            };
            
            const giftsBag = {
                x: santa.x + 50,
                y: santa.y + 30,
                width: 40,
                height: 50,
                collected: false
            };
            
            // Препятствия
            let obstacles = [];
            let snowflakes = [];
            
            // Клавиши управления
            const keys = {
                left: false,
                right: false,
                space: false
            };
            
            // Обработчики событий клавиатуры
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') keys.left = true;
                if (e.key === 'ArrowRight') keys.right = true;
                if (e.key === ' ') {
                    e.preventDefault();
                    keys.space = true;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowLeft') keys.left = false;
                if (e.key === 'ArrowRight') keys.right = false;
                if (e.key === ' ') keys.space = false;
            });
            
            // Инициализация игры
            function initGame() {
                score = 0;
                timeLeft = 60;
                distance = 100;
                gifts = 0;
                
                player.x = 100;
                player.y = canvas.height - 150;
                player.isJumping = false;
                player.velocityY = 0;
                
                santa.x = canvas.width - 250;
                santa.y = canvas.height - 200;
                
                giftsBag.x = santa.x + 50;
                giftsBag.y = santa.y + 30;
                giftsBag.collected = false;
                
                obstacles = [];
                snowflakes = [];
                
                // Создаем начальные препятствия и снежинки
                for (let i = 0; i < 5; i++) {
                    createObstacle();
                }
                
                for (let i = 0; i < 10; i++) {
                    createSnowflake();
                }
                
                updateUI();
            }
            
            // Создание препятствия
            function createObstacle() {
                const types = ['snow', 'tree'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                const obstacle = {
                    x: canvas.width + Math.random() * 500,
                    y: canvas.height - (type === 'snow' ? 100 : 150),
                    width: type === 'snow' ? 80 : 60,
                    height: type === 'snow' ? 50 : 100,
                    type: type,
                    speed: 5 + Math.random() * 3
                };
                
                obstacles.push(obstacle);
            }
            
            // Создание снежинки
            function createSnowflake() {
                const snowflake = {
                    x: canvas.width + Math.random() * 800,
                    y: Math.random() * (canvas.height - 200),
                    radius: 5 + Math.random() * 8,
                    speed: 2 + Math.random() * 3
                };
                
                snowflakes.push(snowflake);
            }
            
            // Обновление игрового состояния
            function updateGame() {
                if (!gameRunning || gamePaused) return;
                
                // Очищаем canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Рисуем фон
                drawBackground();
                
                // Обновляем позицию Деда Мороза
                updateSanta();
                
                // Обновляем позицию игрока
                updatePlayer();
                
                // Обновляем препятствия
                updateObstacles();
                
                // Обновляем снежинки
                updateSnowflakes();
                
                // Проверяем столкновения
                checkCollisions();
                
                // Рисуем все объекты
                drawSanta();
                drawPlayer();
                drawObstacles();
                drawSnowflakes();
                drawGiftsBag();
                
                // Обновляем UI
                updateUI();
                
                // Проверяем условия победы/проигрыша
                checkGameStatus();
            }
            
            // Рисуем фон
            function drawBackground() {
                // Зимнее небо
                ctx.fillStyle = '#0a2e38';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Снег на земле
                ctx.fillStyle = '#f0f8ff';
                ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
                
                // Звезды
                ctx.fillStyle = 'white';
                for (let i = 0; i < 30; i++) {
                    const x = (i * 70) % canvas.width;
                    const y = (i * 30) % (canvas.height - 200);
                    const size = Math.random() * 2 + 1;
                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Елки на заднем плане
                ctx.fillStyle = '#0d5c3a';
                for (let i = 0; i < 5; i++) {
                    const x = (i * 200) % canvas.width;
                    const y = canvas.height - 180;
                    drawTree(ctx, x, y, 40, 80);
                }
            }
            
            // Рисуем елку
            function drawTree(ctx, x, y, width, height) {
                ctx.fillStyle = '#0d5c3a';
                
                // Ярусы елки
                ctx.beginPath();
                ctx.moveTo(x, y + height);
                ctx.lineTo(x + width/2, y);
                ctx.lineTo(x + width, y + height);
                ctx.closePath();
                ctx.fill();
                
                // Ствол
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(x + width/2 - 5, y + height, 10, 20);
                
                // Украшения
                ctx.fillStyle = '#ff2a2a';
                ctx.beginPath();
                ctx.arc(x + width/2, y + height/3, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffd166';
                ctx.beginPath();
                ctx.arc(x + width/3, y + height/2, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#a8e6cf';
                ctx.beginPath();
                ctx.arc(x + 2*width/3, y + 2*height/3, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Обновляем позицию Деда Мороза
            function updateSanta() {
                // Дед Мороз движется вправо
                santa.x += santa.speed;
                giftsBag.x = santa.x + 50;
                
                // Если Дед Мороз уезжает за край экрана
                if (santa.x > canvas.width) {
                    santa.x = -santa.width;
                    giftsBag.collected = false;
                }
                
                // Обновляем расстояние до Деда Мороза
                distance = Math.max(0, Math.floor((santa.x - player.x) / 10));
            }
            
            // Обновляем позицию игрока
            function updatePlayer() {
                // Движение влево/вправо
                if (keys.left && player.x > 0) {
                    player.x -= player.speed;
                }
                if (keys.right && player.x < canvas.width - player.width) {
                    player.x += player.speed;
                }
                
                // Прыжок
                if (keys.space && !player.isJumping) {
                    player.isJumping = true;
                    player.velocityY = -player.jumpPower;
                }
                
                // Гравитация
                if (player.isJumping) {
                    player.y += player.velocityY;
                    player.velocityY += player.gravity;
                    
                    // Проверяем, приземлился ли игрок
                    if (player.y >= canvas.height - 150) {
                        player.y = canvas.height - 150;
                        player.isJumping = false;
                        player.velocityY = 0;
                    }
                }
            }
            
            // Обновляем препятствия
            function updateObstacles() {
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    obstacles[i].x -= obstacles[i].speed;
                    
                    // Если препятствие ушло за левый край, удаляем его
                    if (obstacles[i].x < -obstacles[i].width) {
                        obstacles.splice(i, 1);
                        createObstacle();
                        score += 5; // Начисляем очки за преодоленное препятствие
                    }
                }
            }
            
            // Обновляем снежинки
            function updateSnowflakes() {
                for (let i = snowflakes.length - 1; i >= 0; i--) {
                    snowflakes[i].x -= snowflakes[i].speed;
                    
                    // Если снежинка ушла за левый край, удаляем её
                    if (snowflakes[i].x < -10) {
                        snowflakes.splice(i, 1);
                        createSnowflake();
                    }
                }
            }
            
            // Проверяем столкновения
            function checkCollisions() {
                // Проверка столкновения с подарками
                if (!giftsBag.collected && 
                    player.x < giftsBag.x + giftsBag.width &&
                    player.x + player.width > giftsBag.x &&
                    player.y < giftsBag.y + giftsBag.height &&
                    player.y + player.height > giftsBag.y) {
                    
                    giftsBag.collected = true;
                    gifts++;
                    score += 50;
                    
                    // Показываем сообщение о собранном подарке
                    showMessage("Вы получили подарок!", 1000);
                }
                
                // Проверка столкновения с препятствиями
                for (const obstacle of obstacles) {
                    if (player.x < obstacle.x + obstacle.width &&
                        player.x + player.width > obstacle.x &&
                        player.y < obstacle.y + obstacle.height &&
                        player.y + player.height > obstacle.y) {
                        
                        // Столкновение - отбрасываем игрока и отнимаем очки
                        player.x -= 30;
                        score = Math.max(0, score - 10);
                        timeLeft = Math.max(0, timeLeft - 3);
                        
                        // Показываем сообщение о столкновении
                        showMessage("Ой! Будьте осторожнее!", 1000);
                    }
                }
                
                // Проверка столкновения со снежинками
                for (let i = snowflakes.length - 1; i >= 0; i--) {
                    const snowflake = snowflakes[i];
                    const dx = player.x + player.width/2 - snowflake.x;
                    const dy = player.y + player.height/2 - snowflake.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    
                    if (distance < player.width/2 + snowflake.radius) {
                        // Собираем снежинку
                        snowflakes.splice(i, 1);
                        createSnowflake();
                        score += 10;
                    }
                }
            }
            
            // Проверяем состояние игры
            function checkGameStatus() {
                // Проверяем, догнал ли игрок Деда Мороза
                if (player.x + player.width >= santa.x && !giftsBag.collected) {
                    // Игрок догнал Деда Мороза
                    giftsBag.collected = true;
                    gifts++;
                    score += 100;
                    
                    showMessage("Вы догнали Деда Мороза!", 1500);
                }
                
                // Проверяем время
                if (timeLeft <= 0) {
                    endGame(false);
                }
                
                // Проверяем, собраны ли все подарки
                if (gifts >= 5) {
                    endGame(true);
                }
            }
            
            // Рисуем Деда Мороза
            function drawSanta() {
                // Олени
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(santa.x - 40, santa.y + 70, 150, 20); // Тело оленя
                
                // Рога
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.moveTo(santa.x - 30, santa.y + 60);
                ctx.lineTo(santa.x - 50, santa.y + 40);
                ctx.lineTo(santa.x - 30, santa.y + 50);
                ctx.closePath();
                ctx.fill();
                
                // Повозка
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(santa.x, santa.y + 40, 120, 40);
                
                // Колеса
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.arc(santa.x + 30, santa.y + 80, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(santa.x + 90, santa.y + 80, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // Дед Мороз
                ctx.fillStyle = '#ff2a2a';
                ctx.fillRect(santa.x + 40, santa.y, 40, 50); // Шуба
                
                ctx.fillStyle = 'white';
                ctx.fillRect(santa.x + 40, santa.y + 40, 40, 10); // Мех
                
                // Лицо
                ctx.fillStyle = '#ffe4c4';
                ctx.beginPath();
                ctx.arc(santa.x + 60, santa.y + 20, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // Борода
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(santa.x + 60, santa.y + 30, 15, 0, Math.PI);
                ctx.fill();
                
                // Шапка
                ctx.fillStyle = '#ff2a2a';
                ctx.fillRect(santa.x + 45, santa.y - 10, 30, 20);
                ctx.beginPath();
                ctx.arc(santa.x + 60, santa.y - 10, 15, 0, Math.PI);
                ctx.fill();
            }
            
            // Рисуем игрока (снеговика)
            function drawPlayer() {
                // Тело снеговика
                ctx.fillStyle = 'white';
                
                // Нижний шар
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height - 20, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // Средний шар
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height - 50, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Голова
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height - 75, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // Глаза
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.arc(player.x + player.width/2 - 5, player.y + player.height - 78, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(player.x + player.width/2 + 5, player.y + player.height - 78, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Нос (морковка)
                ctx.fillStyle = '#ff8c42';
                ctx.beginPath();
                ctx.moveTo(player.x + player.width/2, player.y + player.height - 75);
                ctx.lineTo(player.x + player.width/2 + 15, player.y + player.height - 75);
                ctx.lineTo(player.x + player.width/2, player.y + player.height - 70);
                ctx.closePath();
                ctx.fill();
                
                // Шляпа
                ctx.fillStyle = '#333';
                ctx.fillRect(player.x + player.width/2 - 12, player.y + player.height - 92, 24, 8);
                ctx.fillRect(player.x + player.width/2 - 8, player.y + player.height - 110, 16, 20);
            }
            
            // Рисуем препятствия
            function drawObstacles() {
                for (const obstacle of obstacles) {
                    if (obstacle.type === 'snow') {
                        // Снежный сугроб
                        ctx.fillStyle = '#e6f7ff';
                        ctx.beginPath();
                        ctx.ellipse(obstacle.x + obstacle.width/2, obstacle.y, obstacle.width/2, 20, 0, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.ellipse(obstacle.x + obstacle.width/2, obstacle.y - 15, obstacle.width/3, 15, 0, 0, Math.PI * 2);
                        ctx.fill();
                    } else {
                        // Ёлка
                        drawTree(ctx, obstacle.x, obstacle.y - obstacle.height, obstacle.width, obstacle.height);
                    }
                }
            }
            
            // Рисуем снежинки
            function drawSnowflakes() {
                ctx.fillStyle = 'white';
                for (const snowflake of snowflakes) {
                    ctx.beginPath();
                    ctx.arc(snowflake.x, snowflake.y, snowflake.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // Рисуем мешок с подарками
            function drawGiftsBag() {
                if (giftsBag.collected) return;
                
                // Мешок
                ctx.fillStyle = '#ff2a2a';
                ctx.fillRect(giftsBag.x, giftsBag.y, giftsBag.width, giftsBag.height);
                
                // Завязка
                ctx.fillStyle = '#ffd166';
                ctx.fillRect(giftsBag.x, giftsBag.y + giftsBag.height/2 - 5, giftsBag.width, 10);
                
                // Буквы "ПОДАРКИ"
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ПОДАРКИ', giftsBag.x + giftsBag.width/2, giftsBag.y + giftsBag.height/2 + 4);
            }
            
            // Обновляем UI
            function updateUI() {
                scoreElement.textContent = score;
                timeElement.textContent = timeLeft;
                distanceElement.textContent = distance;
                giftsElement.textContent = gifts;
            }
            
            // Показываем сообщение
            function showMessage(text, duration) {
                messageTitle.textContent = "Внимание!";
                messageText.textContent = text;
                gameMessage.style.display = 'block';
                
                setTimeout(() => {
                    gameMessage.style.display = 'none';
                }, duration);
            }
            
            // Завершаем игру
            function endGame(isWin) {
                gameRunning = false;
                clearInterval(gameInterval);
                clearInterval(timeInterval);
                
                if (isWin) {
                    messageTitle.textContent = "ПОБЕДА!";
                    messageText.textContent = `Вы догнали Деда Мороза и собрали все подарки! Ваш счет: ${score}`;
                } else {
                    messageTitle.textContent = "ВРЕМЯ ВЫШЛО!";
                    messageText.textContent = `Вы не успели догнать Деда Мороза. Ваш счет: ${score}`;
                }
                
                gameMessage.style.display = 'block';
                pauseButton.disabled = true;
                startButton.disabled = false;
            }
            
            // Обработчики кнопок
            startButton.addEventListener('click', () => {
                if (!gameRunning) {
                    gameRunning = true;
                    gamePaused = false;
                    startButton.disabled = true;
                    pauseButton.disabled = false;
                    
                    // Если игра еще не инициализирована, инициализируем
                    if (score === 0 && timeLeft === 60) {
                        initGame();
                    }
                    
                    // Запускаем игровой цикл
                    gameInterval = setInterval(updateGame, 1000/60);
                    
                    // Запускаем таймер
                    timeInterval = setInterval(() => {
                        if (gameRunning && !gamePaused) {
                            timeLeft--;
                            if (timeLeft <= 0) {
                                clearInterval(timeInterval);
                            }
                        }
                    }, 1000);
                }
            });
            
            pauseButton.addEventListener('click', () => {
                if (gameRunning) {
                    gamePaused = !gamePaused;
                    pauseButton.textContent = gamePaused ? 'Продолжить' : 'Пауза';
                    
                    if (gamePaused) {
                        showMessage("Игра на паузе", 2000);
                    }
                }
            });
            
            restartBtn.addEventListener('click', () => {
                clearInterval(gameInterval);
                clearInterval(timeInterval);
                gameRunning = false;
                gamePaused = false;
                startButton.disabled = false;
                pauseButton.disabled = true;
                pauseButton.textContent = 'Пауза';
                gameMessage.style.display = 'none';
                initGame();
                updateGame(); // Отрисовываем начальное состояние
            });
            
            restartButton.addEventListener('click', () => {
                gameMessage.style.display = 'none';
                restartBtn.click();
            });
            
            // Инициализируем игру при загрузке
            initGame();
            updateGame(); // Отрисовываем начальное состояние
        });
    </script>
</body>
</html>
